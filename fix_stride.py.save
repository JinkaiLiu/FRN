#!/usr/bin/env python3
import re

# 读取文件
with open('retinanet/dataloader_dsec_det.py', 'r') as f:
    content = f.read()

# 修复 h5py 读取
content = re.sub(
    r"events_([txpy]) = f\['events/([txpy])'\]\[:\]",
    r"events_\1 = f['events/\2'][:].copy()",
    content
)

# 修复 torch.from_numpy
content = re.sub(
    r"return torch\.from_numpy\(([^)]+)\)\.float\(\)",
    r"return torch.from_numpy(\1.copy()).float()",
    content
) 

# 写回文件
with open('retinanet/dataloader_dsec_det.py', 'w') as f:
    f.write(content)

print("✅ 已修复numpy stride问题")
